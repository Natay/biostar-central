---
- hosts: all
  user: www


  handlers:
    - import_tasks: files/handlers.yml
      static: yes

  tasks:
    - include_vars: files/vars.yml
    - name: Install reqs
      shell: ls
      notify:
        - python install

    - name: Backup servers
      shell: ls
      notify:
        - server backup
        -
    - name: Update the biostar-engine
      git:
        repo: "{{ engine_git }}"
        dest: "{{ engine_dir }}"
        update: yes
      notify:
        - server migrate
        - reload supervisor
        - restart nginx

    - name: Restart servers
      shell: ls
      notify:
        - python install
        - server migrate
        - reload supervisor
        - restart nginx
        - restart server
      when: restart



