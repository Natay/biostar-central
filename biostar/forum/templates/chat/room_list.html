{% extends "forum_list.html" %}
{% load forum_tags %}
{% load humanize %}
{% block headtitle %}
    Biostar Chat
{% endblock %}

{% block content %}
<div class="ui horizontal segments">

<div class="ui segment">

    <div class="ui relaxed divided list">
        {% for room in chat_rooms %}

            {% chat_room_detail room=room %}

        {% endfor %}
    <div id="room-insert"></div>
    </div>

    <div class="ui action fluid input">
        <input class="ui input" id="room-name-input" type="text" placeholder="Create a chat room."/><br/>
        <button id="room-name-submit" type="button" value="Enter">Create</button>
    </div>

</div>


    <div class="ui segment" id="chat-insert" style="background-color: #f6f6f6;">
    <b>{{ room.name }}</b>

    <div id="chat-log" class="ui blue segment" style="width: 100%; height: 300px; overflow-y: auto;background-color: #fcfcfc;">

        {% for message in messages %}
            {% chat_message message=message %}
        {% endfor %}

    </div>

    <div class="ui action input">
        <input id="chat-message-input" style="width: 100%;" type="text" size="100" data-username="{{ user.profile.name }}"/>
        <button id="chat-message-submit" type="button" value="Send" class="ui button">Send</button>
    </div>
</div>


</div>

<script>
    document.querySelector('#room-name-input').focus();
    document.querySelector('#room-name-input').onkeyup = function (e) {
        if (e.keyCode === 13) {  // enter, return
            document.querySelector('#room-name-submit').click();
            alert("HHH");
        }
    };

    document.querySelector('#room-name-submit').onclick = function (e) {
        var roomName = document.querySelector('#room-name-input').value;
        let list_container = $('#room-insert');
        let view_container = $('#chat-insert');

        $.ajax('/chat/ajax/create/room/', {
            type: 'GET',
            dataType: 'json',
            data: {
                'room': roomName
            },
            success: function (data) {
                if (data.status === 'error') {
                    //alert(data.msg);
                    popup_message(list_container, data.msg, 'error', 1000)
                } else {
                    //alert(data.html);
                    //alert(container.html());
                    list_container.before(data.list_html);
                    view_container.html(data.view_html);
                    $('#chat-log').animate({scrollTop: $('#chat-log').prop("scrollHeight")}, 500)
                    //$('#chat-log').scroll()//$('#chat-log').height();
                    //let obj = document.getElementById("#chat-log");
                    //obj.scrollTop = obj.scrollHeight - obj.clientHeight;
                }

            },
            error: function (xhr, status, text) {
                error_message($(this), xhr, status, text)
            }
        });

        //window.location.pathname = '/ajax/create/room/';


    };
</script>
{% endblock %}

